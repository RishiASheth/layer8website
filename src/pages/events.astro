---
import Layout from '../layouts/Layout.astro';
import { readdir, readFile } from 'fs/promises';
import { join } from 'path';

// Read all event markdown files
const eventsDir = join(process.cwd(), 'src/content/events');
const eventFiles = await readdir(eventsDir);

const events = await Promise.all(
  eventFiles
    .filter(file => file.endsWith('.md'))
    .map(async (file) => {
      const content = await readFile(join(eventsDir, file), 'utf-8');

      const frontmatterMatch = content.match(/^---\n([\s\S]*?)\n---/);
      const frontmatter: any = {};

      if (frontmatterMatch) {
        const frontmatterText = frontmatterMatch[1];
        frontmatterText.split('\n').forEach(line => {
          const [key, ...valueParts] = line.split(':');
          if (key && valueParts.length) {
            frontmatter[key.trim()] = valueParts
              .join(':')
              .trim()
              .replace(/['"]/g, '');
          }
        });
      }

      return {
        slug: file.replace('.md', ''),
        ...frontmatter
      };
    })
);

// Sort by date
events.sort(
  (a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()
);
---

<Layout title="Events">
  <header class="page-header">
    <h1>&lt; Events_Grid /&gt;</h1>
    <p>Hackathons ‚Ä¢ Workshops ‚Ä¢ Tech Talks</p>
  </header>

  <section class="events-grid">
    {events.map(event => (
      <article class="event-card">
        <h2>{event.title}</h2>

        <div class="event-meta">
          <p>üìÖ {new Date(event.date).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          })}</p>
          <p>üïí {event.time}</p>
          <p>üìç {event.location}</p>
        </div>

        <a href={`/events/${event.slug}`} class="read-more">
          Access Event ‚Üí
        </a>
      </article>
    ))}
  </section>
</Layout>

<style>
/* ---------- HEADER ---------- */
.page-header {
  text-align: center;
  margin-bottom: 4rem;
}

.page-header h1 {
  font-size: clamp(2.4rem, 5vw, 3.2rem);
  letter-spacing: 0.15em;
  margin-bottom: 0.8rem;
  background: linear-gradient(135deg, #7f7cff, #00ffe0);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow:
    0 0 20px rgba(127,124,255,0.6),
    0 0 40px rgba(0,255,224,0.3);
}

.page-header p {
  color: #9aa2ff;
  font-size: 1.1rem;
}

/* ---------- GRID ---------- */
.events-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 2.2rem;
}

/* ---------- EVENT CARD ---------- */
.event-card {
  background: rgba(15, 18, 35, 0.85);
  border-radius: 20px;
  padding: 2.2rem;
  border: 1px solid rgba(127,124,255,0.35);
  backdrop-filter: blur(16px);
  box-shadow:
    inset 0 0 20px rgba(127,124,255,0.1),
    0 20px 40px rgba(0,0,0,0.45);
  transition: all 0.35s ease;
  position: relative;
  overflow: hidden;
}

.event-card::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(
    120deg,
    transparent,
    rgba(0,255,224,0.15),
    transparent
  );
  opacity: 0;
  transition: opacity 0.4s ease;
}

.event-card:hover::before {
  opacity: 1;
}

.event-card:hover {
  transform: translateY(-6px) scale(1.02);
  box-shadow:
    0 0 40px rgba(127,124,255,0.45),
    0 0 80px rgba(0,255,224,0.25);
}

/* ---------- CONTENT ---------- */
.event-card h2 {
  font-size: 1.5rem;
  margin-bottom: 1rem;
  color: #e6e9ff;
}

.event-meta {
  margin-bottom: 1.6rem;
}

.event-meta p {
  color: #9aa2ff;
  margin: 0.4rem 0;
  font-size: 0.95rem;
}

/* ---------- LINK ---------- */
.read-more {
  display: inline-block;
  color: #00ffe0;
  font-weight: 600;
  text-decoration: none;
  letter-spacing: 0.08em;
  position: relative;
}

.read-more::after {
  content: "";
  position: absolute;
  left: 0;
  bottom: -6px;
  width: 0;
  height: 2px;
  background: linear-gradient(90deg, #7f7cff, #00ffe0);
  transition: width 0.3s ease;
  box-shadow: 0 0 10px rgba(0,255,224,0.8);
}

.read-more:hover::after {
  width: 100%;
}
</style>
